#### Limit for backend requests to 10 request per minute
limit_req_zone $binary_remote_addr zone=limited_{{SERVER_NAME}}:10m rate=10r/m;

server {
    server_name {{SERVER_NAME}};

#### Set up SSL/TLS
    include /etc/nginx/sites-enabled/defaults/ssl;
    ssl_certificate /etc/letsencrypt/live/{{SERVER_NAME}}/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/{{SERVER_NAME}}/privkey.pem;
    ssl_dhparam /dhparams/{{SERVER_NAME}}.pem;
#### Optional (to use 0-RTT feature of TLSv1.3)
#### Be aware of Replay-Attack risk!
#    ssl_early_data on;

##################
#### FRONTEND ####
##################

#### Custom error pages (404 Not Found, 502 Bad Gateway)
#    error_page 404 /not_found.html;
#    error_page 502 /backend_down.html;

#================#
#=== React.js ===#
#================#

#### React app's build folder was added to root via:
#### webserver static add /path/to/build example.com
#    root /usr/share/nginx/html/{{SERVER_NAME}};
#    include /etc/nginx/sites-enabled/defaults/react;

#=================#
#=== WordPress ===#
#=================#

#### WordPress files root
#    root /usr/share/nginx/html/{{SERVER_NAME}};

#### Configuration for nginx WordPress root location
#    location / {
#        try_files $uri $uri/ /index.php$is_args$args;
#    }

#### Default endpoint for WordPress PHP-FPM proxy
#    location ~ \.php$ {
#        include /etc/nginx/sites-enabled/defaults/php-proxy;
#        fastcgi_pass docker_container_name:9000;
#    }

#################
#### BACKEND ####
#################

#### Default endpoint for API calls from frontend
#    location ^~ /api/ {
#        include /etc/nginx/sites-enabled/defaults/proxy;
#        proxy_pass http://docker_container_name:8080/;
#    }

#### Specific limited API endpoint
#    location =/api/limited {
#        limit_req zone=limited_{{SERVER_NAME}};
#        include /etc/nginx/sites-enabled/defaults/proxy;
#        proxy_pass http://docker_container_name:8080/limited;
#    }
}
