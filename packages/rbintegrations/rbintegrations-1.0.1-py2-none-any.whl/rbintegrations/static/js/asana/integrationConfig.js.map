{"version":3,"sources":["integrationConfig.es6.js"],"names":[],"mappings":";;AAAA,EAAE,YAAW;AACT,QAAM,eAAe,EAAE,wBAAF,CAArB;AACA,QAAM,aAAa,EAAE,qBAAF,CAAnB;AACA,QAAM,SAAS,EAAE,yBAAF,EACV,WADU,CACE,YADF,EAEV,IAFU,EAAf;;AAIA,eAAW,SAAX,CAAqB;AACjB,gBAAQ,KADS;AAEjB,wBAAgB,MAFC;AAGjB,qBAAa,MAHI;AAIjB,oBAAY,IAJK;AAKjB,oBAAY,MALK;AAMjB,gBAAQ;AACJ,kBADI,kBACG,IADH,EACS,MADT,EACiB;AACjB,iCAAe,OAAO,KAAK,IAAZ,CAAf;AACH;AAHG,SANS;AAWjB,gBAXiB,oBAWR,KAXQ,EAWD;AACZ,cAAE,0BAAF,EAA8B,GAA9B,CAAkC,KAAK,OAAL,CAAa,KAAb,EAAoB,IAAtD;AACH;AAbgB,KAArB;;AAgBA,QAAM,YAAY,WAAW,CAAX,EAAc,SAAhC;AACA,cAAU,QAAV,CAAmB,KAAnB,CAAyB,EAAE,UAAF,EAAc,KAAd,EAAzB;AACA,cAAU,OAAV;;AAEA,aAAS,SAAT,CAAmB,QAAnB,EAA6B;AACzB,eACK,IADL,qDAGU,EAAE,MAAF,CAAS,QAAT,CAHV,EAKK,IALL;AAMH;;AAED,QAAI,UAAU,IAAd;;AAEA,QAAM,yBAAyB,EAAE,QAAF,CAAW,YAAM;AAC5C,YAAM,SAAS,aAAa,GAAb,GAAmB,IAAnB,EAAf;;AAEA,YAAI,YAAY,MAAhB,EAAwB;AACpB;AACH;;AAED,kBAAU,MAAV;AACA,eAAO,IAAP;AACA,kBAAU,OAAV;;AAEA,YAAI,OAAO,MAAP,KAAkB,CAAtB,EAAyB;AACrB;AACH;;AAED,kBAAU,IAAV,CAAe,oBAAY;AACvB,gBAAM,SAAS,EAAE,KAAF,CAAQ,EAAE,SAAS,MAAX,EAAR,CAAf;;AAEA,cAAE,IAAF,CAAO;AACH,qBAAQ,SAAR,yCAAqD,MADlD;AAEH,sBAAM,KAFH;AAGH,uBAHG,mBAGK,GAHL,EAGU;AACT,wBAAI,IAAI,MAAJ,KAAe,SAAnB,EAA8B;AAC1B,kCAAU,MAAV;AACA,iCAAS,IAAI,IAAb;AACH,qBAHD,MAGO,IAAI,IAAI,MAAJ,KAAe,OAAnB,EAA4B;AAC/B,kCAAU,IAAI,KAAd;AACA;AACH,qBAHM,MAGA;AACH,gCAAQ,KAAR,CAAc,oCACA,sBADd,EAEc,GAFd;AAGA,kCAAU,kCAAV;AACA;AACH;AACJ,iBAjBE;AAkBH,qBAlBG,iBAkBG,GAlBH,EAkBQ,UAlBR,EAkBoB,WAlBpB,EAkBiC;AAChC,4BAAQ,KAAR,CAAc,oCACA,sBADd,EAEc,GAFd;AAGA,8BAAU,kCAAV;AACA;AACH;AAxBE,aAAP;AA0BH,SA7BD;AA8BH,KA7C8B,EA6C5B,GA7C4B,CAA/B;;AA+CA,iBAAa,EAAb,CAAgB,cAAhB,EAAgC,sBAAhC;AACA;AACH,CAvFD","file":"integrationConfig.js","sourcesContent":["$(function() {\n    const $accessToken = $('#id_asana_access_token');\n    const $workspace = $('#id_asana_workspace');\n    const $error = $('<div class=\"errorlist\">')\n        .insertAfter($accessToken)\n        .hide();\n\n    $workspace.selectize({\n        create: false,\n        dropdownParent: 'body',\n        searchField: 'name',\n        valueField: 'id',\n        labelField: 'name',\n        render: {\n            option(item, escape) {\n                return `<div>${escape(item.name)}</div>`;\n            },\n        },\n        onChange(value) {\n            $('#id_asana_workspace_name').val(this.options[value].name);\n        },\n    });\n\n    const selectize = $workspace[0].selectize;\n    selectize.$control.width($('#id_name').width());\n    selectize.disable();\n\n    function showError(errorStr) {\n        $error\n            .html(dedent`\n                <span class=\"rb-icon rb-icon-warning\"></span>\n                ${_.escape(errorStr)}\n            `)\n            .show();\n    }\n\n    let lastKey = null;\n\n    const changeWorkspaceEnabled = _.throttle(() => {\n        const apiKey = $accessToken.val().trim();\n\n        if (lastKey === apiKey) {\n            return;\n        }\n\n        lastKey = apiKey;\n        $error.hide();\n        selectize.disable();\n\n        if (apiKey.length === 0) {\n            return;\n        }\n\n        selectize.load(callback => {\n            const params = $.param({ api_key: apiKey });\n\n            $.ajax({\n                url: `${SITE_ROOT}rbintegrations/asana/workspaces/?${params}`,\n                type: 'GET',\n                success(res) {\n                    if (res.result === 'success') {\n                        selectize.enable();\n                        callback(res.data);\n                    } else if (res.result === 'error') {\n                        showError(res.error);\n                        callback();\n                    } else {\n                        console.error('Unexpected error when fetching ' +\n                                      'Asana workspace list',\n                                      res);\n                        showError('Unable to communicate with Asana');\n                        callback();\n                    }\n                },\n                error(xhr, textStatus, errorThrown) {\n                    console.error('Unexpected error when fetching ' +\n                                  'Asana workspace list',\n                                  xhr);\n                    showError('Unable to communicate with Asana');\n                    callback();\n                },\n            });\n        });\n    }, 100);\n\n    $accessToken.on('change keyup', changeWorkspaceEnabled);\n    changeWorkspaceEnabled();\n});\n"]}