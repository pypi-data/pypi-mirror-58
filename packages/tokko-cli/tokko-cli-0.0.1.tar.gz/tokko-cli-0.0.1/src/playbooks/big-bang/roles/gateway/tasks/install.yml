---

- name: Clone repository NGINX-Gateway
  git:
    repo: git@github.com:JoseSalgado1024/nginx-service-gateway.git
    force: yes
    version: master
    dest: src/nginx-gateway

- name: Create & Install Gateway
  command: docker-compose -f src/nginx-gateway/docker-compose.yml up -d --force-recreate
  register: pir 


# - name: Lazy validation (UnitTest)
#   command: docker-compose -f src/nginx-gateway/docker-compose.yml exec passport bash -c "python -m unittest tests.UnitTests" 
#   register: lv_unit

# - name: Lazy validation (ServiceTest)
#   command: docker-compose -f src/nginx-gateway/docker-compose.yml exec passport bash -c "python -m unittest tests.ServiceTests" 
#   register: lv_service

- debug:
   msg: "Gateway is installed."
  when:  pir.rc == 0

- debug:
   msg: "Gateway installation fails. ErrCode: {{ pir.rc }}"
  when:  pir.rc > 0
  