
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Usage &#8212; pyAMPS 1.0.0 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pyAMPS 1.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="usage">
<span id="id1"></span><h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>pyAMPS can be used to calculate model ionospheric currents and associated magnetic fields. Below we show the recommended approach for two different use cases: 1) calculations on a grid of magnetic coordinates for a fixed set of external conditions, and 2) calculations at one or more points as the external conditions change. The former is useful for working with and plotting global maps, and the latter is useful for comparison with point measurements in space and on ground.</p>
<div class="section" id="calculations-on-grid-the-amps-class">
<h2>Calculations on grid - the AMPS class<a class="headerlink" href="#calculations-on-grid-the-amps-class" title="Permalink to this headline">¶</a></h2>
<p>The <cite>AMPS</cite> class is used for calculating magnetic field disturbances and currents on a grid:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># initialize by supplying a set of external conditions:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyamps</span> <span class="kn">import</span> <span class="n">AMPS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">AMPS</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="c1"># Solar wind velocity in km/s</span>
<span class="go">              -4, # IMF By (GSM) in nT</span>
<span class="go">              -3, # IMF Bz (GSM) in nT,</span>
<span class="go">              20, # dipole tilt angle in degrees</span>
<span class="go">              80) # F107_index</span>
</pre></div>
</div>
<p>The member function <cite>plot_currents</cite> allows for a quick look at the polar current system in both hemispheres associated with the chosen external condiditions:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">plot_currents</span><span class="p">()</span>
</pre></div>
</div>
<img alt="" src="_images/example_plot.png" />
<p>Through the <cite>AMPS</cite> object, the various parts of the current system can be calculated on a grid. For example, the upward current:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Ju</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_upward_current</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Ju will be evaluated at the following coords:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mlat</span><span class="p">,</span> <span class="n">mlt</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">scalargrid</span>
</pre></div>
</div>
<p>User-defined grids can also be used:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mlat</span><span class="p">,</span> <span class="n">mlt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">75</span><span class="p">,</span> <span class="o">-</span><span class="mi">75</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Ju</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_upward_current</span><span class="p">(</span><span class="n">mlat</span><span class="p">,</span> <span class="n">mlt</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Ju</span>
<span class="go">array([ 0.25088252, -0.05726114])</span>
</pre></div>
</div>
<p>The following member functions work in the same way as <cite>get_upward_current</cite>:</p>
<dl class="docutils">
<dt><cite>get_divergence_free_current_function</cite></dt>
<dd>The divergence-free part of the horizontal current, represented as a scalar function that is similar to the equivalent current function which is often derived from ground magnetometer measurements.</dd>
<dt><cite>get_curl_free_current_potential</cite></dt>
<dd>The field-aligned currents can be used to derive a curl-free horizontal current, by solving the current continuity equation. Since it is curl-free, it is the gradient of a potential. This function returns that potential.</dd>
<dt><cite>get_toroidal_scalar</cite></dt>
<dd>The disturbance magnetic field is expressed as a sum of a poloidal and toroidal part, both of which relates to scalars. This function can be used to calculate the toroidal scalar (which relates to field-aligned currents).</dd>
<dt><cite>get_poloidal_scalar</cite></dt>
<dd>Same as above, only for the poloidal scalar (which relates to the divergence-free part of the horizontal currents).</dd>
</dl>
<p>The above functions return scalar quantities. There are also functions that return vector quantities. The default grid for vector quantities is given by the <cite>m.vectorgrid</cite> parameter. The functions that return vector quantities are:</p>
<dl class="docutils">
<dt><cite>get_divergence_free_current</cite></dt>
<dd>The divergence-free part of the horizontal current, magnetic eastward and northward components</dd>
<dt><cite>get_curl_free_current</cite></dt>
<dd>The curl-free part of the horizontal current, magnetic eastward and northward components</dd>
<dt><cite>get_total_current</cite></dt>
<dd>The total horizontal current, the sum of curl-free and divergence-free parts, magnetic eastward and northward components.</dd>
</dl>
<p>In addition, the following functions are available:</p>
<dl class="docutils">
<dt><cite>get_ground_perturbation</cite></dt>
<dd>Calculate ground magnetic field perturbations associated with an equivalent current that is equal to that returned by <cite>get_divergence_free_current_function</cite>. This function returns eastward and northward components, at a set of points provided by the user</dd>
<dt><cite>get_integrated_upward_current</cite></dt>
<dd>Integrate the upward currents poleward of <cite>m.minlat</cite>. The function returns the integral of upward and downward currents in both hemispheres.</dd>
<dt><cite>get_AE_indices</cite></dt>
<dd>Calculate model auroral electrojet indices, AL and AU, in both hemispheres. This calculation is based on the same assumptions as in <cite>get_ground_perturbation</cite></dd>
</dl>
<p>All calculations with the <cite>AMPS</cite> object depend on a height, which by default is 110 km. The horizontal currents are assumed to flow in a spherical shell at this height, and the field-aligned currents are mapped to this height. It can be changed at initialization.</p>
</div>
<div class="section" id="calculations-of-time-series">
<h2>Calculations of time series<a class="headerlink" href="#calculations-of-time-series" title="Permalink to this headline">¶</a></h2>
<p>For comparison with magnetometer measurements, it is necessary to calculate the magnetic field at different positions (for example along a satellite orbit) with changing external parameters. We provide two functions to do such calculations: <cite>get_B_space</cite> and <cite>get_B_ground</cite>. The calculations are parallelized by use of the <cite>dask</cite> module. That means that the calculations are split in chunks and distributed in different threads. The size of each chunk is specified by the <cite>chunksize</cite> keyword, default 15000. Increasing it may reduce calculation time, but it will increase memory consumption. Reduce it to limit memory consumption.</p>
<div class="section" id="calculations-along-satellite-trajectory">
<h3>Calculations along satellite trajectory<a class="headerlink" href="#calculations-along-satellite-trajectory" title="Permalink to this headline">¶</a></h3>
<p>Use <cite>get_B_space</cite> to calculate time series of model magnetic field perturbations in space, above the horizontal current, for example along a satellite trajectory.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyamps</span> <span class="kn">import</span> <span class="n">get_B_space</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># make up some inputs. For the sake of example, they are all</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># equal, but in realistic cases they would vary:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="mi">100000</span> <span class="c1"># number of points that we want to use</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">f107</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">350</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">80</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glat</span><span class="p">,</span> <span class="n">glon</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">450</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mo">02</span><span class="p">,</span> <span class="mi">29</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># calculate the disturbance field for each point (this may take a minute):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Be</span><span class="p">,</span> <span class="n">Bn</span><span class="p">,</span> <span class="n">Bu</span> <span class="o">=</span> <span class="n">get_B_space</span><span class="p">(</span><span class="n">glat</span><span class="p">,</span> <span class="n">glon</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">f107</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">Be</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(100000,)</span>
</pre></div>
</div>
<p>The outputs are the eastward, northward and upward geodetic components of the disturbance magnetic field.</p>
</div>
<div class="section" id="calculations-at-ground">
<h3>Calculations at ground<a class="headerlink" href="#calculations-at-ground" title="Permalink to this headline">¶</a></h3>
<p>On ground, the magnetic signature of the field-aligned currents are zero, and only the divergence-free part of the horizontal current can be detected. We can use the divergence-free part of the horizontal current implied by the model to calculate a corresponding magnetic field perturbation on ground. This is done in the <cite>get_B_ground</cite> function, demonstrated below.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyamps</span> <span class="kn">import</span> <span class="n">get_B_ground</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># make up some inputs. For the sake of example, they are all</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># equal, but in realistic cases they would vary:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="mi">100000</span> <span class="c1"># number of points that we want to use</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">f107</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">350</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">80</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qdlat</span> <span class="o">=</span> <span class="mf">67.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">height</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mlt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mf">4.</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># calculate the disturbance field for each point (this may take a minute):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Be</span><span class="p">,</span> <span class="n">Bn</span><span class="p">,</span> <span class="n">Bu</span> <span class="o">=</span> <span class="n">get_B_ground</span><span class="p">(</span><span class="n">qdlat</span><span class="p">,</span> <span class="n">mlt</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">f107</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">Be</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(100000,)</span>
</pre></div>
</div>
<p>The outputs are eastward, northward and upward components in quasi-dipole coordinates. Notice that <cite>get_B_ground</cite> differs from <cite>get_B_space</cite> in that it takes magnetic coordinates (quasi-dipole latitude and magnetic local time) as input, instead of geographic coordinates, and that it returns magnetic components instead of geographic components.</p>
<p>Also notice that <cite>qdlat</cite> can be either a scalar or an array with the same size as the other inputs, and that <cite>height</cite> should always be a scalar.</p>
<p>The calculations in <cite>get_B_ground</cite> depend on the height chosen for the horizontal current. This can be changed with the keyword <cite>current_height</cite>, and it is set to 110 km by default.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_coefficients.html">Coefficient file format</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/usage.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pyAMPS 1.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Karl M. Laundal.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>